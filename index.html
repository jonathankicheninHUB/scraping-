<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>AUDIT SAINT-ANDRÉ | LIVE DATA</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { background: #0f172a; color: #f8fafc; font-family: sans-serif; padding: 20px; }
        .card { background: #1e293b; border: 1px solid #334155; margin-bottom: 20px; }
        .val { font-size: 2.5rem; font-weight: bold; color: white; }
        .source { font-size: 0.7rem; color: #94a3b8; font-family: monospace; border-top: 1px solid #334155; padding-top: 5px; margin-top: 10px; display: block; }
        .badge-live { background: #10b981; color: #022c22; padding: 5px 10px; border-radius: 4px; font-weight: bold; font-size: 0.8rem; }
    </style>
</head>
<body>

    <div class="d-flex justify-content-between align-items-center mb-5">
        <h1><i class="fas fa-server me-2"></i>SAINT-ANDRÉ <span class="text-primary">AUDIT</span></h1>
        <div><span class="badge-live">API CONNECTÉE</span> <small class="text-muted ms-2" id="last-update">...</small></div>
    </div>

    <div class="row">
        <div class="col-md-4">
            <div class="card p-4">
                <h6 class="text-uppercase text-muted">Démographie</h6>
                <div class="val" id="pop">Chargement...</div>
                <div class="source"><i class="fas fa-link"></i> <span id="src-pop">--</span></div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card p-4">
                <h6 class="text-uppercase text-muted">Tissu Économique</h6>
                <div class="val text-warning" id="eco">Chargement...</div>
                <div class="source"><i class="fas fa-link"></i> <span id="src-eco">--</span></div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card p-4">
                <h6 class="text-uppercase text-muted">Politique de la Ville</h6>
                <div class="val text-danger" id="qpv" style="font-size: 1.5rem;">--</div>
                <div class="source"><i class="fas fa-link"></i> <span id="src-qpv">--</span></div>
            </div>
        </div>
    </div>

    <div class="row mt-4">
        <div class="col-12">
            <div class="card p-4">
                <h5 class="border-bottom border-secondary pb-2 mb-3">Archives Électorales (Données Certifiées Ministère)</h5>
                <table class="table table-dark table-striped">
                    <thead><tr><th>Année</th><th>Vainqueur</th><th>Score 2nd Tour</th></tr></thead>
                    <tbody id="archives-body"></tbody>
                </table>
                <small class="text-muted">Ces données proviennent des archives numérisées et ne sont pas mises à jour en temps réel.</small>
            </div>
        </div>
    </div>

    <script>
        fetch('data.json')
            .then(r => r.json())
            .then(data => {
                // Meta
                document.getElementById('last-update').innerText = data.meta.last_update;

                // Pop
                document.getElementById('pop').innerText = data.kpi.population.valeur;
                document.getElementById('src-pop').innerText = data.kpi.population.source;

                // Eco
                document.getElementById('eco').innerText = data.kpi.economie.valeur;
                document.getElementById('src-eco').innerText = data.kpi.economie.source;

                // QPV
                document.getElementById('qpv').innerText = data.kpi.social.qpv;
                document.getElementById('src-qpv').innerText = data.kpi.social.source;

                // Archives
                const tb = document.getElementById('archives-body');
                const h = data.archives.politique.data;
                // Simple affichage statique pour l'exemple
                tb.innerHTML = `
                    <tr><td>2020</td><td>${h['2020'].vainqueur}</td><td class="fw-bold">${h['2020'].score}%</td></tr>
                    <tr><td>2014</td><td>${h['2014'].vainqueur}</td><td class="fw-bold">${h['2014'].score}%</td></tr>
                    <tr><td>2008</td><td>${h['2008'].vainqueur}</td><td class="fw-bold">${h['2008'].score}%</td></tr>
                `;
            })
            .catch(e => {
                document.body.innerHTML = "<h3 style='color:red; text-align:center; margin-top:50px'>Erreur de chargement des données. Vérifiez l'action GitHub.</h3>";
            });
    </script>
</body>
</html>

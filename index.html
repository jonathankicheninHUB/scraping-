<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>CONSOLE DE DÉBOGAGE</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>body{background:#111; color:#0f0; font-family:monospace; padding:20px;}</style>
</head>
<body>
    <h3>CONSOLE DE DIAGNOSTIC</h3>
    <p>Dernière mise à jour : <span id="time">Chargement...</span></p>
    <hr>
    <h5>JOURNAL D'AUDIT (Du Script Python) :</h5>
    <div id="logs" style="border:1px solid #333; padding:10px; margin-bottom:20px;"></div>
    
    <h5>CONTENU BRUT (JSON) :</h5>
    <pre id="raw" style="color:#aaa"></pre>

    <script>
        fetch('data.json?v=' + new Date().getTime()) // Force le non-cache
            .then(r => r.json())
            .then(data => {
                document.getElementById('time').innerText = data.meta.last_run;
                document.getElementById('raw').innerText = JSON.stringify(data, null, 2);
                
                let logsHTML = "";
                data.audit_logs.forEach(l => {
                    let color = l.status === "OK" ? "green" : "red";
                    logsHTML += `<div style="color:${color}">[${l.source}] ${l.status} : ${l.details}</div>`;
                });
                document.getElementById('logs').innerHTML = logsHTML;
            })
            .catch(e => {
                document.body.innerHTML += `<h1 style="color:red">ERREUR FATALE : Impossible de lire data.json</h1><p>${e}</p>`;
            });
    </script>
</body>
</html>

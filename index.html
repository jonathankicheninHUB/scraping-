<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Observatoire Historique Saint-Andr√©</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --primary: #2563eb; --bg: #f8fafc; --card-bg: #ffffff; }
        body { background-color: var(--bg); font-family: 'Inter', sans-serif; color: #1e293b; padding-bottom: 40px; }
        
        .header { background: #fff; padding: 1.5rem; border-bottom: 1px solid #e2e8f0; margin-bottom: 2rem; display: flex; justify-content: space-between; align-items: center; }
        .title { font-weight: 800; font-size: 1.4rem; color: #0f172a; }
        
        .card-kpi { background: var(--card-bg); border-radius: 12px; padding: 1.5rem; box-shadow: 0 2px 4px rgba(0,0,0,0.05); border: none; height: 100%; transition: transform 0.2s; }
        .card-kpi:hover { transform: translateY(-3px); }
        .kpi-lbl { font-size: 0.8rem; text-transform: uppercase; font-weight: 600; color: #64748b; margin-bottom: 0.5rem; }
        .kpi-val { font-size: 2rem; font-weight: 800; color: #0f172a; line-height: 1; }
        
        .nav-pills .nav-link { color: #64748b; font-weight: 600; margin-right: 10px; border-radius: 8px; }
        .nav-pills .nav-link.active { background-color: var(--primary); color: white; }
        
        .table-custom th { font-size: 0.75rem; text-transform: uppercase; color: #64748b; padding-bottom: 10px; }
        .table-custom td { padding: 15px 5px; border-bottom: 1px solid #f1f5f9; vertical-align: middle; }
        
        .chart-box { position: relative; height: 250px; width: 100%; margin-top: 15px; }
        .chart-lg { position: relative; height: 350px; width: 100%; margin-top: 15px; }
        
        .badge-maire { padding: 5px 10px; border-radius: 6px; color: white; font-weight: bold; font-size: 0.85rem; }
        .section-title { font-weight: 700; color: #334155; margin-bottom: 15px; border-left: 4px solid var(--primary); padding-left: 10px; }
    </style>
</head>
<body>

    <div class="header">
        <div class="title"><i class="fas fa-history text-primary"></i> SAINT-ANDR√â : M√âMOIRE POLITIQUE</div>
        <span class="badge bg-light text-dark border" id="last-update">Chargement...</span>
    </div>

    <div class="container">
        <div class="row g-4 mb-4">
            <div class="col-md-3"><div class="card-kpi"><div class="kpi-lbl">Population</div><div class="kpi-val" id="kpi-pop">--</div></div></div>
            <div class="col-md-3"><div class="card-kpi"><div class="kpi-lbl">Pauvret√©</div><div class="kpi-val text-danger" id="kpi-pauvrete">--</div></div></div>
            <div class="col-md-3"><div class="card-kpi"><div class="kpi-lbl">Maire Actuel</div><div class="kpi-val h3" id="kpi-maire">--</div></div></div>
            <div class="col-md-3"><div class="card-kpi"><div class="kpi-lbl">Dette/Hab</div><div class="kpi-val text-warning" id="kpi-dette">--</div></div></div>
        </div>

        <ul class="nav nav-pills mb-4" id="pills-tab" role="tablist">
            <li class="nav-item"><button class="nav-link active" data-bs-toggle="pill" data-bs-target="#tab-pol">üèõÔ∏è Analyse Politique & Mandats</button></li>
            <li class="nav-item"><button class="nav-link" data-bs-toggle="pill" data-bs-target="#tab-soc">‚ù§Ô∏è Social & S√©curit√©</button></li>
            <li class="nav-item"><button class="nav-link" data-bs-toggle="pill" data-bs-target="#tab-his">üìà D√©mographie & Finances</button></li>
        </ul>

        <div class="tab-content">
            <div class="tab-pane fade show active" id="tab-pol">
                
                <div class="card-kpi mb-4">
                    <h5 class="section-title">Guerre des Blocs (1983 - 2020)</h5>
                    <p class="text-muted small">√âvolution des forces politiques : Droite (Virapoull√©) vs Gauche (PCR/B√©dier)</p>
                    <div class="chart-lg"><canvas id="macroChart"></canvas></div>
                </div>

                <div class="row g-4 mb-4">
                    <div class="col-md-8">
                        <div class="card-kpi h-100">
                            <h5 class="section-title">Benchmark des Mandats</h5>
                            <table class="table-custom w-100">
                                <thead><tr><th>P√©riode</th><th>Maire</th><th>Parti</th><th>Dette Fin</th><th>Pop.</th><th>Style</th></tr></thead>
                                <tbody id="bench-body"></tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div class="col-md-4">
                        <div class="card-kpi h-100">
                            <h5 class="section-title">Zoom √âlections</h5>
                            <select class="form-select mb-3" id="select-elec" onchange="updateElecChart(this.value)">
                                <option value="2020">2020 - Victoire B√©dier</option>
                                <option value="2014">2014 - Retour Virapoull√©</option>
                                <option value="2008">2008 - Victoire Fruteau</option>
                            </select>
                            <div class="chart-box"><canvas id="detailElecChart"></canvas></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="tab-pane fade" id="tab-soc">
                <div class="row g-4">
                    <div class="col-md-4">
                        <div class="card-kpi">
                            <h5 class="section-title">Indicateurs de Pr√©carit√©</h5>
                            <div class="d-flex justify-content-between mb-2"><span>Ch√¥mage Jeunes</span><span class="fw-bold text-danger" id="soc-chomage">--</span></div>
                            <div class="progress mb-3" style="height:6px"><div class="progress-bar bg-danger" style="width:48%"></div></div>
                            <div class="d-flex justify-content-between mb-2"><span>Illettrisme</span><span class="fw-bold text-warning" id="soc-illettrisme">--</span></div>
                            <div class="progress mb-3" style="height:6px"><div class="progress-bar bg-warning" style="width:22%"></div></div>
                            <ul class="list-group list-group-flush mt-3">
                                <li class="list-group-item d-flex justify-content-between"><span>Alloc. CAF</span><span class="fw-bold" id="soc-caf">--</span></li>
                                <li class="list-group-item d-flex justify-content-between"><span>RSA</span><span class="fw-bold" id="soc-rsa">--</span></li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-md-8">
                        <div class="card-kpi">
                            <h5 class="section-title">S√©curit√© (2015-2023)</h5>
                            <div class="chart-lg"><canvas id="secuChart"></canvas></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="tab-pane fade" id="tab-his">
                <div class="row g-4">
                    <div class="col-md-8">
                        <div class="card-kpi">
                            <h5 class="section-title">Trajectoire D√©mographique (1968-2022)</h5>
                            <div class="chart-lg"><canvas id="demoChart"></canvas></div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card-kpi">
                            <h5 class="section-title">Dette Publique</h5>
                            <div class="chart-lg"><canvas id="detteChart"></canvas></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        let globalData;
        let detailChart;

        async function load() {
            try {
                const r = await fetch('data.json');
                if(!r.ok) throw new Error("Erreur JSON");
                globalData = await r.json();

                // KPI
                document.getElementById('last-update').innerText = "MAJ: " + globalData.meta.last_update;
                document.getElementById('kpi-pop').innerText = globalData.kpi.pop;
                document.getElementById('kpi-pauvrete').innerText = globalData.kpi.pauvrete;
                document.getElementById('kpi-maire').innerText = globalData.kpi.maire.split(' ')[1];
                document.getElementById('kpi-dette').innerText = globalData.kpi.dette_hab;

                // SOCIAL
                document.getElementById('soc-chomage').innerText = globalData.diagnostic.social.chomage_jeunes;
                document.getElementById('soc-illettrisme').innerText = globalData.diagnostic.social.illettrisme;
                document.getElementById('soc-caf').innerText = globalData.diagnostic.social.allocataires_caf;
                document.getElementById('soc-rsa').innerText = globalData.diagnostic.social.beneficiaires_rsa;

                // BENCHMARK TABLE
                const tb = document.getElementById('bench-body');
                tb.innerHTML = '';
                globalData.benchmark.forEach(b => {
                    tb.innerHTML += `<tr><td><strong>${b.periode}</strong></td><td><span class="badge-maire" style="background:${b.color}">${b.maire}</span></td><td>${b.parti}</td><td class="fw-bold">${b.dette_fin}</td><td>${b.pop_evo}</td><td>${b.style}</td></tr>`;
                });

                // CHART MACRO POLITIQUE
                new Chart(document.getElementById('macroChart'), {
                    type: 'line',
                    data: {
                        labels: globalData.macro_politique.annees,
                        datasets: [
                            { label: 'Bloc Droite (Virapoull√©)', data: globalData.macro_politique.bloc_droite, borderColor: '#0d6efd', tension: 0.3, borderWidth: 3 },
                            { label: 'Bloc Gauche (PCR/B√©dier)', data: globalData.macro_politique.bloc_gauche, borderColor: '#dc3545', tension: 0.3, borderWidth: 3 },
                            { label: 'Participation', data: globalData.macro_politique.participation, borderColor: '#95a5a6', borderDash: [5,5], hidden: true }
                        ]
                    },
                    options: { maintainAspectRatio: false, scales: { y: { min: 30, max: 70 } } }
                });

                // INIT DETAIL CHART
                const ctx = document.getElementById('detailElecChart').getContext('2d');
                detailChart = new Chart(ctx, { type: 'doughnut', data: { labels: [], datasets: [{ data: [] }] }, options: { maintainAspectRatio: false, plugins: { legend: { position: 'bottom' } } } });
                updateElecChart('2020');

                // OTHER CHARTS
                new Chart(document.getElementById('secuChart'), { type: 'line', data: { labels: globalData.history.annees_secu, datasets: [{ label: 'Faits', data: globalData.history.faits_delinquance, borderColor: '#334155', backgroundColor: 'rgba(51, 65, 85, 0.1)', fill: true, tension: 0.4 }] }, options: { maintainAspectRatio: false } });
                new Chart(document.getElementById('demoChart'), { type: 'line', data: { labels: globalData.history.annees_demo, datasets: [{ label: 'Habitants', data: globalData.history.pop, borderColor: '#2563eb', borderWidth: 3 }] }, options: { maintainAspectRatio: false } });
                new Chart(document.getElementById('detteChart'), { type: 'bar', data: { labels: globalData.history.annees_fin, datasets: [{ label: 'Dette ‚Ç¨', data: globalData.history.dette, backgroundColor: '#f59e0b', borderRadius: 4 }] }, options: { maintainAspectRatio: false } });

            } catch (e) { console.error(e); }
        }

        function updateElecChart(year) {
            const d = globalData.politics_details[year];
            detailChart.data.labels = d.candidats;
            detailChart.data.datasets[0].data = d.scores;
            detailChart.data.datasets[0].backgroundColor = d.couleurs;
            detailChart.update();
        }

        load();
    </script>
</body>
</html>

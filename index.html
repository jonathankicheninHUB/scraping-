<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Observatoire Stratégique Saint-André</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { background-color: #f0f2f5; font-family: 'Segoe UI', sans-serif; }
        .header { background: #34495e; color: white; padding: 2rem 0; margin-bottom: 2rem; border-bottom: 5px solid #e67e22; }
        .card { border: none; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); margin-bottom: 1.5rem; }
        .card-header { background-color: white; border-bottom: 1px solid #f0f0f0; font-weight: bold; text-transform: uppercase; color: #7f8c8d; }
        .kpi-num { font-size: 2rem; font-weight: 800; color: #2c3e50; }
        .kpi-label { font-size: 0.8rem; color: #95a5a6; text-transform: uppercase; }
        .table-benchmark thead { background-color: #2c3e50; color: white; }
    </style>
</head>
<body>

<div class="header text-center">
    <h1><i class="fas fa-landmark"></i> Saint-André : Vision Macro & Historique</h1>
    <p>Benchmark des Mandats (1972-2024) • Social • Finances</p>
    <span class="badge bg-light text-dark">Mise à jour : <span id="date">...</span></span>
</div>

<div class="container">

    <div class="row text-center mb-2">
        <div class="col-md-2"><div class="card p-3"><div class="kpi-label">Population</div><div class="kpi-num" id="pop">--</div></div></div>
        <div class="col-md-2"><div class="card p-3"><div class="kpi-label">Maire</div><div class="kpi-num h5" id="maire">--</div><small class="text-success" id="parti">--</small></div></div>
        <div class="col-md-2"><div class="card p-3"><div class="kpi-label">Pauvreté</div><div class="kpi-num text-danger" id="pauvrete">--</div></div></div>
        <div class="col-md-2"><div class="card p-3"><div class="kpi-label">Dette/Hab</div><div class="kpi-num text-warning" id="dette">--</div></div></div>
        <div class="col-md-2"><div class="card p-3"><div class="kpi-label">Chômage</div><div class="kpi-num text-danger" id="chomage">--</div></div></div>
        <div class="col-md-2"><div class="card p-3"><div class="kpi-label">Entreprises</div><div class="kpi-num h5" id="entreprises">--</div></div></div>
    </div>

    <h4 class="text-secondary mb-3"><i class="fas fa-balance-scale"></i> Benchmark des Mandats (1972 - 2024)</h4>
    <div class="row">
        <div class="col-md-12">
            <div class="card">
                <div class="card-header">Guerre Politique : Évolution des Blocs (1983-2020)</div>
                <div class="card-body">
                    <canvas id="macroElecChart" height="80"></canvas>
                </div>
            </div>
        </div>
        <div class="col-md-12">
            <div class="card">
                <div class="card-header">Comparatif des Gestionnaires</div>
                <div class="table-responsive">
                    <table class="table table-hover table-benchmark mb-0">
                        <thead>
                            <tr>
                                <th>Période</th>
                                <th>Maire</th>
                                <th>Orientation</th>
                                <th>Dette Fin Mandat</th>
                                <th>Dyn. Pop</th>
                                <th>Marqueur</th>
                            </tr>
                        </thead>
                        <tbody id="benchmark-body">
                            </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <h4 class="text-secondary mb-3 mt-4"><i class="fas fa-notes-medical"></i> Diagnostic Social (Le Terrain)</h4>
    <div class="row">
        <div class="col-md-4">
            <div class="card h-100">
                <div class="card-header">Comparatif Pauvreté</div>
                <div class="card-body"><canvas id="pauvreteChart"></canvas></div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card h-100">
                <div class="card-header">Indicateurs Clés</div>
                <div class="card-body">
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item d-flex justify-content-between">Alloc. CAF <span class="badge bg-primary" id="caf">--</span></li>
                        <li class="list-group-item d-flex justify-content-between">RSA <span class="badge bg-danger" id="rsa">--</span></li>
                        <li class="list-group-item d-flex justify-content-between">Illettrisme <span class="badge bg-warning text-dark" id="illettrisme">--</span></li>
                        <li class="list-group-item d-flex justify-content-between">HLM <span class="badge bg-info text-dark" id="hlm">--</span></li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card h-100">
                <div class="card-header">Sécurité (2005-2023)</div>
                <div class="card-body"><canvas id="secuChart"></canvas></div>
            </div>
        </div>
    </div>

    <h4 class="text-secondary mb-3 mt-4"><i class="fas fa-history"></i> Mémoire & Finances</h4>
    <div class="row">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">Trajectoire Démographique (1968-2022)</div>
                <div class="card-body"><canvas id="demoChart" height="100"></canvas></div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card">
                <div class="card-header">Trajectoire Dette (10 ans)</div>
                <div class="card-body"><canvas id="detteChart"></canvas></div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    async function init() {
        try {
            const r = await fetch('data.json');
            if(!r.ok) throw new Error();
            const data = await r.json();

            // KPI
            document.getElementById('date').innerText = data.meta.last_update;
            document.getElementById('pop').innerText = data.kpi.pop;
            document.getElementById('maire').innerText = data.kpi.maire.split(' ')[1];
            document.getElementById('parti').innerText = data.kpi.parti;
            document.getElementById('pauvrete').innerText = data.diagnostic.social.taux_pauvrete;
            document.getElementById('dette').innerText = data.kpi.dette_hab;
            document.getElementById('chomage').innerText = data.kpi.chomage;
            document.getElementById('entreprises').innerText = data.kpi.entreprises;

            // SOCIAL LIST
            document.getElementById('caf').innerText = data.diagnostic.social.allocataires_caf;
            document.getElementById('rsa').innerText = data.diagnostic.social.beneficiaires_rsa;
            document.getElementById('illettrisme').innerText = data.diagnostic.education.illettrisme_jdc;
            document.getElementById('hlm').innerText = data.diagnostic.logement.parc_social;

            // TABLEAU BENCHMARK
            const benchBody = document.getElementById('benchmark-body');
            benchBody.innerHTML = '';
            data.benchmark.forEach(m => {
                benchBody.innerHTML += `
                    <tr>
                        <td><strong>${m.periode}</strong></td>
                        <td style="color:${m.couleur} !important; font-weight:bold;">${m.maire}</td>
                        <td><span class="badge" style="background-color:${m.couleur}">${m.tendance}</span></td>
                        <td>${m.dette_fin_mandat}</td>
                        <td>${m.pop_evolution}</td>
                        <td><small>${m.faits_marquants}</small></td>
                    </tr>
                `;
            });

            // CHART MACRO ELECTIONS (1983-2020)
            new Chart(document.getElementById('macroElecChart'), {
                type: 'line',
                data: {
                    labels: data.macro_elections.annees,
                    datasets: [
                        { label: 'Bloc Droite (Virapoullé)', data: data.macro_elections.scores_droite, borderColor: '#0d6efd', tension: 0.3 },
                        { label: 'Bloc Gauche (PCR/Union)', data: data.macro_elections.scores_gauche, borderColor: '#dc3545', tension: 0.3 },
                        { label: 'Participation', data: data.macro_elections.participation, borderColor: '#7f8c8d', borderDash: [5, 5], tension: 0.3 }
                    ]
                },
                options: { scales: { y: { beginAtZero: false, min: 30, max: 80 } } }
            });

            // AUTRES CHARTS (Existants)
            new Chart(document.getElementById('pauvreteChart'), {
                type: 'bar',
                data: {
                    labels: data.diagnostic.social.comparaison_pauvrete.labels,
                    datasets: [{ label: '%', data: data.diagnostic.social.comparaison_pauvrete.data, backgroundColor: ['#e74c3c', '#bdc3c7', '#bdc3c7'] }]
                },
                options: { plugins: { legend: { display: false } } }
            });

            new Chart(document.getElementById('secuChart'), {
                type: 'line',
                data: {
                    labels: data.history.annees_secu,
                    datasets: [{ label: 'Faits Constatés', data: data.history.faits_delinquance, borderColor: '#2c3e50', fill: true, backgroundColor: 'rgba(44,62,80,0.1)' }]
                }
            });

            new Chart(document.getElementById('demoChart'), {
                type: 'line',
                data: {
                    labels: data.history.annees_demo,
                    datasets: [{ label: 'Habitants', data: data.history.pop, borderColor: '#3498db' }]
                }
            });

            new Chart(document.getElementById('detteChart'), {
                type: 'bar',
                data: {
                    labels: data.history.annees_fin,
                    datasets: [{ label: 'Dette €', data: data.history.dette, backgroundColor: '#f1c40f' }]
                }
            });

        } catch (e) {
            console.error(e);
        }
    }
    init();
</script>
</body>
</html>

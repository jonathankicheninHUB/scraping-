<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SAINT-ANDR√â | WAR ROOM</title>
    
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --bg-dark: #0f172a;       /* Bleu Nuit Profond */
            --panel-bg: #1e293b;      /* Panneaux */
            --accent: #3b82f6;        /* Bleu Action */
            --danger: #ef4444;        /* Rouge Alerte */
            --warning: #f59e0b;       /* Orange Alerte */
            --text-main: #f8fafc;
            --text-muted: #94a3b8;
        }

        body { 
            background-color: var(--bg-dark); 
            color: var(--text-main); 
            font-family: 'Inter', sans-serif; 
            padding-bottom: 50px;
        }

        /* HEADER & NAVBAR */
        .navbar {
            background: rgba(15, 23, 42, 0.95);
            border-bottom: 1px solid #334155;
            backdrop-filter: blur(10px);
        }
        .navbar-brand { font-weight: 800; letter-spacing: -0.5px; color: white !important; }
        .badge-live { 
            font-family: 'JetBrains Mono'; font-size: 0.7rem; 
            background: rgba(16, 185, 129, 0.1); color: #10b981; 
            border: 1px solid #10b981; padding: 4px 8px; border-radius: 4px;
            animation: pulse 2s infinite;
        }

        /* KPI CARDS */
        .kpi-card {
            background: var(--panel-bg);
            border: 1px solid #334155;
            border-radius: 8px;
            padding: 1.5rem;
            height: 100%;
            transition: transform 0.2s;
        }
        .kpi-card:hover { transform: translateY(-3px); border-color: var(--accent); }
        .kpi-label { font-size: 0.75rem; text-transform: uppercase; color: var(--text-muted); font-weight: 600; margin-bottom: 5px; }
        .kpi-value { font-size: 2rem; font-weight: 800; line-height: 1; }
        .kpi-sub { font-size: 0.8rem; margin-top: 5px; opacity: 0.8; }

        /* TABS NAVIGATION */
        .nav-pills .nav-link {
            color: var(--text-muted);
            font-weight: 600;
            background: rgba(255,255,255,0.05);
            margin-right: 10px;
            border: 1px solid transparent;
        }
        .nav-pills .nav-link.active {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }

        /* TABLES */
        .table-dark-custom { --bs-table-bg: transparent; color: var(--text-muted); font-size: 0.85rem; }
        .table-dark-custom th { border-bottom: 1px solid #475569; color: white; text-transform: uppercase; font-size: 0.75rem; }
        .table-dark-custom td { border-bottom: 1px solid #334155; padding: 12px 5px; vertical-align: middle; }
        
        /* CHARTS & MAP */
        .chart-container { position: relative; height: 300px; width: 100%; }
        #map { height: 350px; width: 100%; border-radius: 8px; border: 1px solid #334155; filter: grayscale(20%); }

        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
    </style>
</head>
<body>

    <nav class="navbar fixed-top">
        <div class="container-fluid px-4">
            <a class="navbar-brand" href="#"><i class="fas fa-database text-primary me-2"></i>SAINT-ANDR√â <span class="text-primary">DATA</span></a>
            <div class="d-flex align-items-center gap-3">
                <span class="text-muted small" id="last-update">--</span>
                <span class="badge-live">‚óè DONN√âES VALID√âES</span>
            </div>
        </div>
    </nav>

    <div class="container-fluid px-4" style="margin-top: 80px;">
        
        <div class="row g-3 mb-4">
            <div class="col-md-2">
                <div class="kpi-card">
                    <div class="kpi-label">Population</div>
                    <div class="kpi-value" id="kpi-pop">--</div>
                </div>
            </div>
            <div class="col-md-2">
                <div class="kpi-card">
                    <div class="kpi-label">Maire Actuel</div>
                    <div class="kpi-value h4 mb-0" id="kpi-maire">--</div>
                    <div class="kpi-sub text-primary" id="kpi-parti">--</div>
                </div>
            </div>
            <div class="col-md-2">
                <div class="kpi-card">
                    <div class="kpi-label">Risque Social</div>
                    <div class="kpi-value text-danger" id="kpi-pauvrete">--</div>
                    <div class="kpi-sub">Taux Pauvret√©</div>
                </div>
            </div>
            <div class="col-md-2">
                <div class="kpi-card">
                    <div class="kpi-label">Dette / Hab</div>
                    <div class="kpi-value text-warning" id="kpi-dette">--</div>
                </div>
            </div>
            <div class="col-md-2">
                <div class="kpi-card">
                    <div class="kpi-label">Entreprises</div>
                    <div class="kpi-value h4 mb-0" id="kpi-eco">--</div>
                </div>
            </div>
            <div class="col-md-2">
                <div class="kpi-card">
                    <div class="kpi-label">S√©curit√©</div>
                    <div class="kpi-value h4 mb-0 text-danger">Moyen</div>
                    <div class="kpi-sub">Stable (2023)</div>
                </div>
            </div>
        </div>

        <ul class="nav nav-pills mb-4" id="pills-tab" role="tablist">
            <li class="nav-item"><button class="nav-link active" data-bs-toggle="pill" data-bs-target="#tab-pol">üèõÔ∏è STRAT√âGIE POLITIQUE</button></li>
            <li class="nav-item"><button class="nav-link" data-bs-toggle="pill" data-bs-target="#tab-soc">‚ù§Ô∏è SOCIAL & TERRITOIRE</button></li>
            <li class="nav-item"><button class="nav-link" data-bs-toggle="pill" data-bs-target="#tab-hist">üìà HISTORIQUE & FINANCES</button></li>
        </ul>

        <div class="tab-content">
            
            <div class="tab-pane fade show active" id="tab-pol">
                <div class="row g-4">
                    <div class="col-lg-8">
                        <div class="kpi-card mb-4">
                            <h5 class="text-white mb-4">Guerre des Blocs (1983 - 2020)</h5>
                            <div class="chart-container" style="height: 250px;">
                                <canvas id="macroChart"></canvas>
                            </div>
                        </div>
                        
                        <div class="kpi-card">
                            <h5 class="text-white mb-3">Benchmark des Mandats</h5>
                            <div class="table-responsive">
                                <table class="table table-dark-custom mb-0">
                                    <thead><tr><th>P√©riode</th><th>Maire</th><th>Parti</th><th>Dette Fin</th><th>Style</th></tr></thead>
                                    <tbody id="bench-body"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-4">
                        <div class="kpi-card h-100">
                            <h5 class="text-white mb-3">Zoom Scrutins Cl√©s</h5>
                            <select class="form-select bg-dark text-white border-secondary mb-3" id="elec-select" onchange="updateElec(this.value)">
                                <option value="2020">Municipales 2020 (Victoire B√©dier)</option>
                                <option value="2014">Municipales 2014 (Retour Virapoull√©)</option>
                                <option value="2008">Municipales 2008 (Victoire Fruteau)</option>
                            </select>
                            <div class="chart-container" style="height: 250px;">
                                <canvas id="detailElecChart"></canvas>
                            </div>
                            <div class="alert alert-dark mt-3 small border border-secondary" id="elec-analyse">
                                -- Analyse --
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="tab-pane fade" id="tab-soc">
                <div class="row g-4">
                    <div class="col-lg-4">
                        <div class="kpi-card h-100">
                            <h5 class="text-white mb-4">Indicateurs de Pr√©carit√©</h5>
                            
                            <div class="mb-3">
                                <div class="d-flex justify-content-between mb-1 small"><span>Ch√¥mage Jeunes (15-24 ans)</span> <span class="text-danger fw-bold" id="soc-chomage">--</span></div>
                                <div class="progress" style="height:6px"><div class="progress-bar bg-danger" style="width:48%"></div></div>
                            </div>
                            <div class="mb-3">
                                <div class="d-flex justify-content-between mb-1 small"><span>Illettrisme (JDC)</span> <span class="text-warning fw-bold" id="soc-illettrisme">--</span></div>
                                <div class="progress" style="height:6px"><div class="progress-bar bg-warning" style="width:22%"></div></div>
                            </div>

                            <hr class="border-

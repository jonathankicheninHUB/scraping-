<!DOCTYPE html>
<html lang="fr" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <title>DATA ADMIN | SAINT-ANDRÉ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { background-color: #111827; color: #e5e7eb; font-family: monospace; }
        .sidebar { height: 100vh; background: #1f2937; border-right: 1px solid #374151; padding: 20px; }
        .status-dot { width: 10px; height: 10px; border-radius: 50%; display: inline-block; margin-right: 5px; }
        .bg-success-glow { background: #10b981; box-shadow: 0 0 10px #10b981; }
        .bg-error-glow { background: #ef4444; box-shadow: 0 0 10px #ef4444; }
        
        .card-audit { background: #000; border: 1px solid #374151; margin-bottom: 15px; }
        .card-header { border-bottom: 1px solid #374151; font-weight: bold; text-transform: uppercase; color: #9ca3af; font-size: 0.8rem; }
        
        .table-data { font-size: 0.85rem; }
        .table-data th { color: #6b7280; }
        .table-data td { color: #d1d5db; }
        
        pre { background: #000; padding: 10px; border: 1px solid #374151; color: #10b981; max-height: 300px; }
    </style>
</head>
<body>

<div class="container-fluid">
    <div class="row">
        <div class="col-md-2 sidebar">
            <h5 class="mb-4"><i class="fas fa-database text-primary"></i> DATA MANAGER</h5>
            <div class="d-grid gap-2">
                <button class="btn btn-sm btn-outline-light text-start active" onclick="showSection('audit')"><i class="fas fa-clipboard-list me-2"></i>Audit Scraping</button>
                <button class="btn btn-sm btn-outline-light text-start" onclick="showSection('tables')"><i class="fas fa-table me-2"></i>Voir les Tables</button>
                <button class="btn btn-sm btn-outline-light text-start" onclick="showSection('json')"><i class="fas fa-code me-2"></i>JSON Brut</button>
            </div>
            
            <hr class="border-secondary my-4">
            <div class="small text-muted">
                <div>DERNIER RUN :</div>
                <div id="last-run" class="text-white fw-bold">--</div>
            </div>
        </div>

        <div class="col-md-10 p-4">
            
            <div id="sec-audit">
                <h3 class="mb-4">Journal d'Exécution du Scraper</h3>
                <div class="table-responsive">
                    <table class="table table-dark table-hover border border-secondary">
                        <thead>
                            <tr>
                                <th>Heure</th>
                                <th>Source Ciblée</th>
                                <th>Statut</th>
                                <th>Message Système</th>
                                <th>Données Récupérées</th>
                            </tr>
                        </thead>
                        <tbody id="audit-body">
                            </tbody>
                    </table>
                </div>
            </div>

            <div id="sec-tables" style="display:none;">
                <h3 class="mb-4">Tables de Données Validées</h3>
                
                <div class="row">
                    <div class="col-md-6">
                        <div class="card card-audit">
                            <div class="card-header">Politique Actuelle (Source: Wikipedia)</div>
                            <div class="card-body" id="view-pol">--</div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card card-audit">
                            <div class="card-header">Démographie (Source: API Géo)</div>
                            <div class="card-body" id="view-demo">--</div>
                        </div>
                    </div>
                </div>

                <div class="card card-audit">
                    <div class="card-header">Historique Maires (1972-2024)</div>
                    <div class="card-body p-0">
                        <table class="table table-dark table-sm mb-0">
                            <thead><tr><th>Période</th><th>Nom</th><th>Parti</th></tr></thead>
                            <tbody id="table-maires"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="sec-json" style="display:none;">
                <h3 class="mb-4">Fichier Source (data.json)</h3>
                <pre id="json-viewer">Chargement...</pre>
            </div>

        </div>
    </div>
</div>

<script>
    function showSection(id) {
        document.getElementById('sec-audit').style.display = 'none';
        document.getElementById('sec-tables').style.display = 'none';
        document.getElementById('sec-json').style.display = 'none';
        document.getElementById('sec-' + id).style.display = 'block';
    }

    fetch('data.json')
        .then(r => r.json())
        .then(data => {
            // 1. Meta
            document.getElementById('last-run').innerText = data.meta.last_run;

            // 2. Audit Table
            const auditBody = document.getElementById('audit-body');
            data.audit.forEach(log => {
                let badge = log.status === 'SUCCESS' ? '<span class="badge bg-success">OK</span>' : '<span class="badge bg-danger">FAIL</span>';
                if(log.status === 'WARNING') badge = '<span class="badge bg-warning text-dark">WARN</span>';
                
                auditBody.innerHTML += `
                    <tr>
                        <td class="text-muted">${log.timestamp}</td>
                        <td class="fw-bold text-info">${log.source}</td>
                        <td>${badge}</td>
                        <td>${log.message}</td>
                        <td class="text-end fw-bold">${log.records}</td>
                    </tr>
                `;
            });

            // 3. Tables View
            // Politique
            document.getElementById('view-pol').innerHTML = `
                <div class="d-flex justify-content-between">
                    <span>Maire détecté :</span>
                    <span class="fw-bold text-success">${data.tables.politique_actuelle.maire}</span>
                </div>
                <div class="small text-muted mt-2">Source: ${data.tables.politique_actuelle.source_url}</div>
            `;
            
            // Demo
            document.getElementById('view-demo').innerHTML = `
                <div class="display-6">${data.tables.demographie.total}</div>
                <div class="text-muted">Habitants (INSEE ${data.tables.demographie.annee})</div>
            `;

            // Maires
            const mairesBody = document.getElementById('table-maires');
            data.tables.historique_maires.forEach(m => {
                mairesBody.innerHTML += `<tr><td>${m.periode}</td><td>${m.nom}</td><td>${m.parti}</td></tr>`;
            });

            // 4. JSON Raw
            document.getElementById('json-viewer').textContent = JSON.stringify(data, null, 2);
        });
</script>

</body>
</html>
